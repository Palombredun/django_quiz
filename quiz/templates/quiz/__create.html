{% extends "core/base.html" %}
{% load static %}

{% block title%}Créer un quiz{% endblock %}

{% block content %}

<div class="container mx-auto px-8 lg:px-16 py-8">
	<form method="post" class="max-w-md">
		{% csrf_token %}
		<div id="quiz">
			<p class="mb-">
		  		<label class="block text-gray-700 text-sm font-bold mb-2"> {{ quiz_form.title.label }}</label>
		  		<div class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"> {{ quiz_form.title}}</div>
		  	</p>
			<p class="mb-2">
				<label class="block text-gray-700 text-sm font-bold pt-4 text-gray-700"> {{ quiz_form.description.label }}</label>
				<div class="shadow appearance-none border rounded w-full ">{{ quiz_form.description }}</div>
			</p>
			<p class="mb-2">
				<label class="block text-gray-700 text-sm font-bold pt-4 text-gray-700">{{ quiz_form.category.label }}</label>
				<div class="">{{quiz_form.category }}</div>
			</p>
			<p>
				{{ quiz_form.sub_category.label }}
				{{quiz_form.sub_category }}
			</p>
		</div>
		<div id="base-tf" class="py-4">
			{{ tf_form.management_form }}
			{% for tf in tf_form %}
			<p>
				{% for hidden_field in tf.hidden_fields %}
				{{ hidden_field }}
				{% endfor %}
			</p>
			<p>
				<label class="block text-gray-700 text-sm font-bold pt-4 text-gray-700">{{ tf.content.label }}</label>
				<div class="shadow appearance-none border rounded w-full ">{{ tf.content }}</div>
			</p>
			<p>
				<label class="block text-gray-700 text-sm font-bold pt-4 text-gray-700">{{ tf.difficulty.label }}</label>
				{{ tf.difficulty }}
			</p>
			<p>
				<label class="block text-gray-700 text-sm font-bold pt-4 text-gray-700">{{ tf.theme1.label }}</label>
				<div class="shadow appearance-none border rounded w-full ">{{ tf.theme1 }}</div>
			</p>
			<p>
				<label class="block text-gray-700 text-sm font-bold pt-4 text-gray-700">{{ tf.theme2.label }}</label>
				<div class="shadow appearance-none border rounded w-full ">{{ tf.theme2 }}</div>
			</p>
			<p>
				<label class="block text-gray-700 text-sm font-bold pt-4 text-gray-700">{{ tf.theme3.label }}</label>
				<div class="shadow appearance-none border rounded w-full ">{{ tf.theme3 }}</div>
			</p>
			<p>
				<label class="block text-gray-700 text-sm font-bold pt-4 text-gray-700">{{ tf.correct.label }}</label>
				{{ tf.correct }}
			</p>
			{% endfor %}
		</div>

		<div id="base-mc" class="py-4">
			{{ mc_form.management_form }}
			{% for mc in mc_form %}

			<p>
				{% for hidden_field in mc.hidden_fields %}
				{{ hidden_field }}
				{% endfor %}
			</p>
			<p>
				<label class="block text-gray-700 text-sm font-bold pt-4 text-gray-700">{{ mc.content.label }}</label>
				<div class="shadow appearance-none border rounded w-full ">{{ mc.content }}</div>
			</p>
			<p>
				{{ mc.difficulty.label }}
				{{ mc.difficulty }}
			</p>
			<p>
				<label class="block text-gray-700 text-sm font-bold pt-4 text-gray-700">{{ mc.theme1.label }}</label>
				<div class="shadow appearance-none border rounded w-full ">{{ mc.theme1 }}</div>
			</p>
			<p>
				<label class="block text-gray-700 text-sm font-bold pt-4 text-gray-700">{{ mc.theme2.label }}</label>
				<div class="shadow appearance-none border rounded w-full ">{{ mc.theme2 }}</div>
			</p>
			<p>
				<label class="block text-gray-700 text-sm font-bold pt-4 text-gray-700">{{ mc.theme3.label }}</label>
				<div class="shadow appearance-none border rounded w-full ">{{ mc.theme3 }}</div>
			</p>
			<p>
				<label class="block text-gray-700 text-sm font-bold pt-4 text-gray-700">{{ mc.answer1.label }}</label>
				<div class="shadow appearance-none border rounded w-full ">{{ mc.answer1 }}</div>
			</p>
			<p>
				<label class="block text-gray-700 text-sm font-bold pt-4 text-gray-700">{{ mc.answer1_correct.label }}</label>
				{{ mc.answer1_correct }}
			</p>
			<p>
				<label class="block text-gray-700 text-sm font-bold pt-4 text-gray-700">{{ mc.answer2.label }}</label>
				<div class="shadow appearance-none border rounded w-full ">{{ mc.answer2 }}</div>
			</p>
			<p>
				<label class="block text-gray-700 text-sm font-bold pt-4 text-gray-700">{{ mc.answer2_correct.label }}</label>
				{{ mc.answer2_correct }}
			</p>
			<p>
				<label class="block text-gray-700 text-sm font-bold pt-4 text-gray-700">{{ mc.answer3.label }}</label>
				<div class="shadow appearance-none border rounded w-full ">{{ mc.answer3 }}</div>
			</p>
			<p>
				<label class="block text-gray-700 text-sm font-bold pt-4 text-gray-700">{{ mc.answer3_correct.label }}</label>
				{{ mc.answer3_correct }}
			</p>
			{% endfor %}
		</div>

		<div id="forms-container">
		</div>

		<input type="submit" value="Créer">
	</form>
</div>
<button id="add-tf" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full">Ajouter TF</button>
<button id="add-mc" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full">Ajouter MC</button>


<script>
$("#id_tf-0-order").val(1);
$("#id_mc-0-order").val(2);

var total_tf = 1;
var total_mc = 1;
var order = 1;

// Add a TrueFalse Question Form
$(document).on('click', '#add-tf', function(e){
  e.preventDefault();
  var form = $("#base-tf");

  if (order==1) {
  	var newElement = form.clone(true);
  	newElement.prop('id', 'tf-0');
  	$('#forms-container').append(newElement);

  }
  else { 
  	cloneTF(form);
  }
  return false;
});
// Add a MultiChoice Question Form
$(document).on('click', '#add-mc', function(e){
  e.preventDefault();
  var form = $("#base-mc");
  if (order == 1) {
  	var newElement = form.clone(true);
  	newElement.prop('id', 'mc-0');
  	$('#forms-container').append(newElement);
  }
  else {
  	cloneTF(form);
  }
  
  return false;
});

function cloneTF(selector) {
	// clone
	var newElement = $(selector).clone(true);
	// update order value
	newElement.find('#id_tf-' + total_tf).val(order);

	// change id of the div cloned
	newElement.prop('id', 'tf-' + total_tf);

	// update 'for' of the element
	newElement.find('label').each(function() {
    var forValue = $(this).attr('for');
    if (forValue) {
      forValue = forValue.replace('-0-', '-' + total_tf + '-');
      $(this).attr({'for': forValue});
      }
  	});
  	// update 'name' of the element
	newElement.find('name').each(function() {
	var nameValue = $(this).attr('name');
	if (nameValue) {
		nameValue = nameValue.replace('-0-', '-'+total_tf + '-');
		$(this.attr({'name': nameValue}));
		}
	})
	// update 'id' of the element
	newElement.find('id').each(function() {
	var idValue = $(this).attr('id');
	if (idValue) {
		idValue = idValue.replace('-0-', '-'+total_tf + '-');
		$(this.attr({'id': idValue}));
		}
	})

	// append div #forms with newElement
	$('#forms-container').append(newElement);

	total_tf ++;
	order ++;
	return false;
}

function cloneMC(selector) {
	// clone
	var newElement = $(selector).clone(true);
	// update order value
	newElement.find('#id_mc-' + total_mc).val(order);
	// change id of the div cloned
	newElement.prop('id', 'mc-' + total_mc);

	// update 'for' value of the element
	newElement.find('label').each(function() {
    var forValue = $(this).attr('for');
    if (forValue) {
      forValue = forValue.replace('-' + (total_mc-1) + '-', '-' + total_mc + '-');
      $(this).attr({'for': forValue});
      }
  	});
	// append div #forms with newElement
	$('#forms-container').append(newElement);

	total_mc ++;
	order ++;
	return false;
}

// Prevent submit to update the values of max forms
$('form').one('submit', function(e) {
    e.preventDefault();
    console.log("toto");
    // For tf forms
    $("input[name='tf-TOTAL_FORMS']").each(function() {
        this.value = total_tf;
    });
    // For mc forms
    $("input[name='mc-TOTAL_FORMS']").each(function() {
        this.value = total_mc;
    });
    //Delete the two basic forms :
    //$("#base-tf").remove();
    //$("#base-mc").remove();
    // Submit the forms
    //$(this).submit();
});
</script>
{% endblock %}