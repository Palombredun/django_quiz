<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>


<h1>Cr√©er quiz</h1>
<br>
<br>
<form method="POST" id="quiz-form">
    {% csrf_token %}
    <div class="quiz-form" id="quizForm">
      {{ quiz_form.as_p }}
    <br>
    <hr>
    <br>
    </div>
    <div class="tf-form" id="base-tf-form">
      {{ tf_form.as_p }}
    <br>
    <hr>
    <br>
    </div>
    <div id="forms">
    </div>
      <input type="submit" value="J'ai fini !" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full">
</form>
  <button class="add-tf-form bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full" id="add-tf">Ajouter TF</button>


<script>
total_tf = 1
order = 1
$("#id_tf-0-order").val(order);

// Add a TrueFalse Question Form
$(document).on('click', '#add-tf', function(e){
  e.preventDefault();
  var form = $("#base-tf-form");

  cloneTF(form);
  return false;
});

$('form').one('submit', function(e) {
  e.preventDefault()
  // For tf forms
  $("input[name='tf-TOTAL_FORMS']").each(function() {
      this.value = total_tf;
  });
  $("input[name='tf-INITIAL_FORMS']").each(function() {
      this.value = 0;
  });
  $("input[name='tf-MIN_NUM_FORMS']").each(function() {
      this.value = 0;
  });
  $("input[name='tf-MAX_NUM_FORMS']").each(function() {
      this.value = 1000;
  });
  console.log(this);
  // Submit the forms
  //$(this).submit()
});


function cloneTF(selector) {
  // get the current total number of tf questions
  total_tf = $('#id_tf-TOTAL_FORMS').val();

  // clone the selected part of the form
  var newElement = $(selector).clone(true);

  // Empty the fields
  newElement.find(':input:not([type=button]):not([type=submit]):not([type=reset])').each(function() {
        var name = $(this).attr('name').replace('-' + (total_tf-1) + '-', '-' + total_tf + '-');
        var id = 'id_' + name;
        $(this).attr({'name': name, 'id': id}).val('').removeAttr('checked');
    });

  // Update the number of tf questions in the labels
  newElement.find('label').each(function() {
    var forValue = $(this).attr('for');
    var idValue = $(this).attr('id');
    var nameValue = $(this).attr('name');
    if (forValue) {
      forValue = forValue.replace('-' + (total_tf-1) + '-', '-' + total_tf + '-');
      $(this).attr({'for': forValue});
      }
    if (idValue) {
      idValue = idValue.replace('-' + (total_tf-1) + '-', '-' + total_tf + '-');
      $(this).attr({'id': idValue});
      }
    if (nameValue) {
      nameValue = nameValue.replace('-' + (total_tf-1) + '-', '-' + total_tf + '-');
      $(this).attr({'name': nameValue});
      }
    });
  var id_order = "id_tf-" + (total_tf-1) + "-order";
  $("#" + id_order).val(order);

  total_tf++;
  order++;
  // change the id value of the new tf question
  $('#id_tf-TOTAL_FORMS').val(total_tf);
  //place it in the div intended for it
  $('#forms').append(newElement);
  
  return false;  
}
</script>